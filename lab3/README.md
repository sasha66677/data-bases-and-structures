# Лабораторная работа 3. Работа с документной БД MongoDB. Паттерн ActiveRecord на примере библиотеки `mongoose`. ~~Работа с миграциями.~~

## Задание на самостоятельное изучение:
- По вот этому туториалу: https://metanit.com/nosql/mongodb/1.1.php ознакомиться с 1 и 2 главой про общие принципы работы с MongoDB.
- Изучить работу с mongodb из node.js по главе 6 https://metanit.com/web/nodejs/6.1.php, пункты 1-4, 6 и 7.
Исходный код всех примеров реализовать самостоятельно и запустить локально.

## Задание на лабораторную:
 - Изучить работу с набором реплик в mongodb:
 https://docs.mongodb.com/manual/tutorial/deploy-replica-set/
 https://coderlessons.com/tutorials/bazy-dannykh/uchitsia-mongodb/mongodb-replikatsiia
 - Развернуть кластер из 3 узлов в режиме Replica Set
 - Реализовать 2 приложения - reader и writer
  - writer-приложение создаёт документ в известной коллекции с числовым полем со значением "0". Каждые 2 секунды writer считывает этот документ из коллекции и обновляет его со значением числового поля, увеличенного на 1.
  - reader-приложение каждую секунду считывает этот же документ и выводит текущее значение числового поля на консоль.
  - В обоих приложениях предусмотреть возможность возникновения ошибки при чтении и записи (try-catch), при возникновении ошибки приложения должны продолжать работать с указанным интервалом.
 - Запустить writer и reader приложения в отдельных процессах, параллельно друг другу.
 - Завершить процесс одного из узлов Replica Set и убедиться, что оба приложения продолжают функционировать, возможно, с единичными ошибками чтения/записи.
 - Аналогично завершить процесс ещё одного узла и проверить работоспособность приложений.
 - Завершить процесс последнего узла и убедиться, что все операции чтения/записи приводят к ошибкам в обоих приложениях.


 https://merrick-krg.medium.com/%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%BE%D0%B9-%D1%82%D1%83%D1%82%D0%BE%D1%80%D0%B8%D0%B0%D0%BB-mongodb-616c92de2235 :
 
mkdir ./cluster/node1
mkdir ./cluster/node2
mkdir ./cluster/arbiter

mongod --replSet myapp --dbpath /data/node1 --port 40000
mongod --replSet myapp --dbpath /data/node2 --port 40001
mongod --replSet myapp --dbpath /data/arbiter --port 40002

mongo --port 40000

rs.initiate()

rs.add('localhost:40001')